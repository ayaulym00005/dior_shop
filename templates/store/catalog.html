<!-- templates/store/catalog.html -->
{% extends 'store/base.html' %}

{% load static %}

{% block title %}Каталог{% endblock %}

{% block content %}
<div class="catalog-container" style="padding: 40px; text-align: center;">
    <h1 style="margin-bottom: 30px;">Наш каталог</h1>
    <div class="product-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
        {% for product in products %}
        <div class="product-card" style="border: 1px solid #ddd; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
            <img src="{% static product.image %}" alt="{{ product.name }}" style="width: 100%; height: 250px; object-fit: cover;">
            <div class="product-details" style="padding: 15px;">
                <h3 style="margin: 0 0 10px;">{{ product.name }}</h3>
                <p style="color: #555; font-size: 14px; margin: 0 0 15px;">{{ product.description|truncatechars:50 }}</p>
                <p style="font-weight: bold; margin: 0 0 15px;">Цена: {{ product.price }} тенге</p>
                <button class="add-to-cart-btn" data-product-id="{{ product.id }}" style="background-color: #5a3f37; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer;">Добавить в корзину</button>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Modal for success message -->
<div id="modal" class="modal">
    <div class="modal-content">
        <span class="close-button" onclick="closeModal()">&times;</span>
        <p id="modal-message"></p>
    </div>
</div>

<!-- Modal styles -->
<style>
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
    }

    .modal-content {
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
    }

    .close-button {
        font-size: 20px;
        font-weight: bold;
        cursor: pointer;
    }
</style>

<!-- JavaScript to handle adding to cart and showing the modal -->
<script>
    // Function to open the modal with a message
    function openModal(message) {
        const modal = document.getElementById('modal');
        const modalMessage = document.getElementById('modal-message');
        modalMessage.textContent = message;
        modal.style.display = 'flex';
    }

    // Function to close the modal
    function closeModal() {
        const modal = document.getElementById('modal');
        modal.style.display = 'none';
    }

    // Function to handle the "Add to Cart" button click
    async function addToCart(productId) {
        try {
            const response = await fetch(`/add-to-cart/${productId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                },
            });

            if (response.ok) {
                const data = await response.json();
                openModal(data.message);  // Show success message in modal
            } else {
                openModal('Ошибка при добавлении товара в корзину.');
            }
        } catch (error) {
            openModal('Произошла ошибка. Попробуйте позже.');
        }
    }

    // Event listener for all "Add to Cart" buttons
    document.querySelectorAll('.add-to-cart-btn').forEach(button => {
        button.addEventListener('click', (event) => {
            const productId = event.target.getAttribute('data-product-id');
            addToCart(productId);
        });
    });
</script>
{% endblock %}


